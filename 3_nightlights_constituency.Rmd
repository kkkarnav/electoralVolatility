---
title: "Where Does The Buck Stop? Economic Conditions & Electoral Volatility"
author: "Karnav Popat & Shashwat Agarwal"
date: "21/03/2024"
output: 
  prettydoc::html_pretty:
    theme: architect
    highlight: vignette
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(tidyverse)
library(dplyr)
library(lubridate)
library(kableExtra)
library(sf)
library(raster)
library(exactextractr)
```

```{r data, include=FALSE}
# partywise_voteshare <- read.csv("./data/partywise_voteshare_constituency.csv")
# volatility <- read.csv("./data/volatility_constituency.csv")

assembly_shp <- st_read("../shp/india_assemblies.shp")
assembly_shp_old <- st_read("../shp/AC_All_Final.shp")
subdistricts_shp <- st_read("../shp/subdistrict.shp")
```

To test our hypothesis, we'd want to narrow this down by calculating electoral volatility separately for the local incumbent party, the ruling state party, and the ruling central party.

## Independent Variable

To measure nationwide economic conditions over time, we use night-lights data as a proxy. This is a well-established though inherently limited practiced. We can get night-lights data from SHRUG.

``` {r shapefile, include=FALSE}
ext <- extent(assembly_shp)
ext_old <- extent(assembly_shp_old)

assembly_data <- assembly_shp %>%
  dplyr::select(state, ac_no=ac, ac_name, -geometry)
assembly_data_old <- assembly_shp_old %>%
  dplyr::select(state=State, ac_no=AC_NO, ac_name=Assem_No, -geometry)
```

```{r upto2013}
for (i in 1992:2013) {
  rasterfile <- raster(paste0("../shrug/li/clipped_", as.character(i), "_calDMSP.tif"))
  assembly_data[paste0("nightlight_", as.character(i))] <- exact_extract(rasterfile, assembly_shp, 'mean', progress=FALSE)
}
```

``` {r upto2021}
for (i in 2014:2021) {
  rasterfile <- raster(paste0("../shrug/li/clipped_", as.character(i), "_simVIIRS.tif"))
  assembly_data_old[paste0("nightlight_", as.character(i))] <- exact_extract(rasterfile, assembly_shp_old, 'mean', progress=FALSE)
}
```

``` {r shapefile_table, echo=FALSE}
kable(head(assembly_data, 10))
kable(head(assembly_data_old, 10))

st_write(assembly_data, "./data/nightlights_constituency.shp", delete_dsn = T)
st_write(assembly_data_old, "./data/nightlights_constituency_old.shp", delete_dsn = T)
```
