---
title: "Where Does The Buck Stop? Economic Conditions & Electoral Volatility"
author: "Karnav Popat"
date: "26/04/2024"
output: 
  prettydoc::html_pretty:
    theme: architect
    highlight: vignette
---

```{r setup, include=FALSE, eval=TRUE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, eval = FALSE)
library(tidyverse)
library(dplyr)
library(lubridate)
library(kableExtra)
library(sf)
library(raster)
library(exactextractr)
library(fuzzyjoin)
library(vtable)
library(zoo)
library(plm)
library(stargazer)
sf_use_s2(FALSE)
```

```{r data, include=FALSE, eval=FALSE}
# The TCPD dataset
assembly <- read.csv("../TCPD/All_States_AE.csv")

# india_assemblies is Sandip Sukhtankar's version of pre-delimitation shapefiles, AC_All_Final is Raphael Susewind's post-delimitation shapefile
assembly_shp <- st_read("../shp/india_assemblies.shp")
assembly_shp_old <- st_read("../shp/AC_All_Final.shp")
```

## Research Question

We know that voters punish incumbents when the economy goes sour. At what level of governance do voters allocate responsibility for economic underperformance? Any voter in India is under atleast three levels of governance: local representation, state government, and central government. In the United States, where popular perception of control is focused on the President, voters tend to punish the President's party. Does this hold true for India, where economic initiative is (or was) significantly more decentralized?

## Dependent Variable

To measure how voters reward and punish retrospective economic conditions, we use electoral volatility. We can calculate this for each constituency and each election using TCPD's assembly election dataset.

```{r tcpd, include=FALSE, eval=FALSE}
kable(head(assembly), caption="Assembly Elections Dataset")
assembly <- assembly%>%
  filter(last_poll == TRUE)
```

The dataset contains a number of electoral indicators which are calculated at the constituency level, rather than being specific to candidate or party. These are the voter turnout (which indicates the level of democratic participation) and Effective Number of Parties (ENOP, which indicates the effective degree of choice that the voter has). They are simple measures of voting behaviour which we will use these as controls while studying the impact of the economy on electoral volatility.

```{r vote_stats_table, echo=FALSE, eval=FALSE}
aggregate_electoral_indicators <- assembly %>%
  group_by(State_Name, Year, Constituency_Name)%>%
  summarize(total_votes=sum(Votes), Electors=first(Electors), Turnout_Percentage=first(Turnout_Percentage), ENOP=first(ENOP))

kable(head(aggregate_electoral_indicators), caption="Aggregate Electoral Indicators") %>%
  kable_styling(font_size=12)
kable(nrow(aggregate_electoral_indicators))%>%
  kable_styling(font_size=12)
```

More comprehensive measures of voting behaviour are calculated from one election to another. We calculate four measures of changing voter behaviour between elections: 

* Change in Incumbent Party's Voteshare
* Change in State-ruling Party's Voteshare
* Change in Central-ruling Party's Voteshare
* Electoral Volatility

The first three are simple to calculate: they are simply the change in the percentage voteshare received by each type of party between one election and the next.  
To accomplish this, we first create binary variables holding the status of each party (whether it won, or was incumbent in, that constituency or state election).

``` {r clean_tcpd, eval=FALSE}
# Aggregate the data by party instead of by candidate
partywise_votes <- assembly %>%
  mutate(is_winner = ifelse(Position == 1, 1, 0))%>%
  
  group_by(State_Name, Constituency_Name, Year, Assembly_No, Party)%>%
  summarize(Votes=sum(Votes), Valid_Votes=sum(Valid_Votes), Electors=first(Electors), Turnout=first(Turnout_Percentage), Constituency_No=first(Constituency_No), Constituency_Type=first(Constituency_Type), Vote_Share_Percentage=sum(Vote_Share_Percentage), ENOP=first(ENOP), is_winner=first(is_winner))%>%
  ungroup()
```

``` {r binaries, eval=FALSE}  
# Calculate incumbent measures
partywise_votes <- partywise_votes%>%
  group_by(State_Name, Assembly_No, Party)%>%
  mutate(seats=sum(is_winner))%>%
  ungroup()%>%
  
  group_by(State_Name, Assembly_No)%>%
  mutate(state_winner = ifelse(seats == max(seats), 1, 0))%>%
  ungroup()%>%
  
  mutate(nat_winner = case_when(
    (Year >= 1947 & Year <= 1971 & Party == "INC") ~ 1,
    (Year > 1971 & Year < 1977 & Party == "INC(I)") ~ 1,
    (Year >= 1977 & Year < 1980 & Party == "JNP") ~ 1,
    (Year >= 1980 & Year <= 1989 & Party == "INC") ~ 1,
    (Year > 1989 & Year < 1991 & Party == "JD") ~ 1,
    (Year >= 1991 & Year < 1996 & Party == "INC") ~ 1,
    (Year >= 1991 & Year < 1996 & Party == "INC") ~ 1,
    (Year >= 1996 & Year < 1998 & Party == "JD") ~ 1,
    (Year >= 1998 & Year < 2004 & Party == "BJP") ~ 1,
    (Year >= 2004 & Year < 2014 & Party == "INC") ~ 1,
    (Year >= 2014 & Year < 2024 & Party == "BJP") ~ 1,
    TRUE ~ 0
  ))%>%

  group_by(State_Name, Constituency_Name, Party)%>%
  mutate(is_incumbent = replace_na(dplyr::lag(is_winner, n=1), 0))%>%
  mutate(state_incumbent = replace_na(dplyr::lag(state_winner, n=1), 0))%>%
  mutate(nat_incumbent = replace_na(dplyr::lag(nat_winner, n=1), 0))%>%
  ungroup()
```

We can then create columns to store the voteshare of the winning and incumbent party at both levels for each election. 

``` {r incumbents, eval=FALSE}
# Create columns for the respective incumbent parties
partywise_votes <- partywise_votes%>%
  mutate(Winning_Party = ifelse(is_winner == 1, Vote_Share_Percentage, 0))%>%
  mutate(State_Win_Party = ifelse(state_winner == 1, Vote_Share_Percentage, 0))%>%
  mutate(Nat_Win_Party = ifelse(nat_winner == 1, Vote_Share_Percentage, 0))%>%
  mutate(Incumbent_Party = ifelse(is_incumbent == 1, Vote_Share_Percentage, 0))%>%
  mutate(State_Incumb_Party = ifelse(state_incumbent == 1, Vote_Share_Percentage, 0))%>%
  mutate(Nat_Incumb_Party = ifelse(nat_incumbent == 1, Vote_Share_Percentage, 0))
```

For further calculations, we'll first have to pivot the dataframe wider, creating a unique column for each unique party holding its voteshare in each election.

``` {r partywise_pivot, eval=FALSE}
# Extract the list of parties
party_list <- as.list(unique(partywise_votes$Party))

# Widen the dataframe for each party
for (party in party_list) {
  partywise_votes[[paste0("Party_", party)]] <- ifelse(partywise_votes$Party == party, partywise_votes$Vote_Share_Percentage, 0)
}

partywise_votes <- partywise_votes%>%
  dplyr::select(-Party, -Votes, -Valid_Votes, -seats)%>%
  group_by(State_Name, Constituency_No, Constituency_Name, Assembly_No, Year, Electors, Turnout, Constituency_Type, ENOP)%>%
  summarise_all(.funs = function(x) sum(x))%>%
  ungroup()
```

```{r partywise_votes_table, echo=FALSE, eval=FALSE}
pv_table <- partywise_votes%>%
  dplyr::select(State_Name, Constituency_Name, Year, Winning_Party, State_Win_Party, Incumbent_Party, State_Incumb_Party, Nat_Incumb_Party)

kable(head(pv_table, 10), caption="Party-wise Vote Shares in Assembly Elections")%>%
  kable_styling(font_size=12)
nrow(pv_table)
# write.csv(partywise_votes, "./data/partywise_voteshare.csv", row.names=FALSE)
```

We can now calculate our final measure. Electoral Volatility is represented by the Pedersen index:
$$
\frac{\sum_{p=1}^{n}V_{pt} - V_{p(t-1)}}{2}
$$
for each party _p_ between election _t_ and _t-1_. We can calculate this from our wide dataframe as follows:

``` {r partywise_deltas, eval=FALSE}
# Calculate the change in voteshare for each party between each pair of elections
partywise_deltas <- partywise_votes%>%
  group_by(State_Name, Constituency_Name)%>%
  
  mutate_at(vars(starts_with("Party_")), 
            funs(abs(. - dplyr::lag(.))))%>%
  mutate_all(~replace(., is.na(.), 0))%>%
  mutate_at(vars(matches("^Party")), as.numeric)%>%
  ungroup()

write.csv(partywise_deltas, "./data/partywise_deltas.csv", row.names=FALSE)
```

``` {r volatility, eval=FALSE}
# Calculate the volatility by summing the deltas for each party
partywise_deltas <- partywise_deltas%>%
  group_by(State_Name, Constituency_Name)%>%
  
  mutate(incumb_change = replace_na(Incumbent_Party - dplyr::lag(Winning_Party), 0))%>%
  mutate(state_incumb_change = replace_na(State_Incumb_Party - dplyr::lag(State_Win_Party), 0))%>%
  mutate(nat_incumb_change = replace_na(Nat_Incumb_Party - dplyr::lag(Nat_Win_Party), 0))%>%
  ungroup()%>%
  
  mutate(volatility=rowSums(dplyr::select(., starts_with("Party_")))/2)

volatility <- partywise_deltas%>%
  dplyr::select(State_Name, Constituency_No, Constituency_Name, Year, Assembly_No, Electors, Turnout, ENOP, volatility, incumb_change, state_incumb_change, nat_incumb_change)
```

``` {r read_volatility, include=FALSE, eval=TRUE}
volatility = read.csv("./data/volatility.csv")
```

``` {r volatility_table, echo=FALSE, eval=FALSE}
v_table <- volatility%>%
  dplyr::select(-Assembly_No, -Electors, -Turnout, -ENOP)

kable(head(v_table, 10), caption="Volatility in Assembly Elections")%>%
  kable_styling(font_size=12)
kable(nrow(v_table))%>%
  kable_styling(font_size=12)

# write.csv(volatility, "./data/volatility.csv", row.names=FALSE)
```

This gives us our dependent variable, electoral volatility, at the constituency level.  

Taking a look at the data, there doesn't seem to be a clear regional trend in volatility. The lowest mean volatility naturally arises from states which only existed for short periods of time: Madras, Mysore, Telangana. The most volatile states seem to be Manipur and Tamil Nadu, which is consistent with their electoral reputation.

``` {r boxplot_state, echo=FALSE, eval=TRUE}
# calculates the median value for each state
state_table <- volatility %>%
  group_by(State_Name)%>%
  summarise(median_vol=median(volatility), na.rm=TRUE)%>%
  arrange(median_vol)

volatility["State_Name"] <- factor(volatility$State_Name, levels = state_table$State_Name)

ggplot(volatility, aes(x = factor(State_Name), y = volatility)) +
  geom_boxplot() +
  labs(title = "Volatility by State") +
  xlab("State/UT") +
  ylab("% Volatiliy") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r boxplot_year, echo=FALSE, eval=TRUE}
ggplot(volatility, aes(x = factor(Assembly_No), y = volatility)) +
  geom_boxplot() +
  labs(title = "Volatility by Election") +
  xlab("Assembly") +
  ylab("% Volatiliy")
```

Looking at electoral volatility over time, it clearly rises over the early Congress era until it peaks after the end of Emergency. There is a pronounced downward trend from then to today, displaying lower highs and lower lows, which is consistent with literature.

``` {r line_year, echo=FALSE, eval=TRUE}
volatility <- volatility%>%
  mutate(
    cycle = case_when(
      Year >= 2021 & Year <= 2025 ~ 2021,
      Year >= 2016 & Year <= 2020 ~ 2016,
      Year >= 2011 & Year <= 2015 ~ 2011,
      Year >= 2006 & Year <= 2010 ~ 2006,
      Year >= 2001 & Year <= 2005 ~ 2001,
      Year >= 1996 & Year <= 2000 ~ 1996,
      Year >= 1991 & Year <= 1995 ~ 1991,
      Year >= 1986 & Year <= 1990 ~ 1986,
      Year >= 1981 & Year <= 1985 ~ 1981,
      Year >= 1976 & Year <= 1980 ~ 1976,
      Year >= 1971 & Year <= 1975 ~ 1971,
      Year >= 1966 & Year <= 1970 ~ 1966,
      Year >= 1961 & Year <= 1965 ~ 1961,
    ))

means <- volatility %>%
  group_by(cycle) %>%
  summarise(mean_volatility = mean(volatility), incumb_change = mean(incumb_change), state_incumb_change = mean(state_incumb_change), nat_incumb_change = mean(nat_incumb_change), across())

ggplot(means, aes(x = cycle, y = mean_volatility)) +
  geom_line() +
  geom_smooth(method = "lm", se = TRUE, color = "blue") + 
  labs(title = "Volatility by Election") +
  xlab("Year") +
  ylab("% Volatiliy") +
  theme(axis.text.x = element_text(angle = 45)) +
  ylim(0, 100)
```

``` {r line_year_modern, echo=FALSE, eval=TRUE}
means_modern <- means%>%
  filter(Year > 1978)

ggplot(means_modern, aes(x = cycle, y = mean_volatility)) +
  geom_line() +
  geom_smooth(method = "lm", se = TRUE, color = "blue") + 
  labs(title = "Volatility by Election") +
  xlab("Year") +
  ylab("% Volatiliy") +
  theme(axis.text.x = element_text(angle = 45)) +
  ylim(0, 100)
```

Similarly, looking at anti-incumbency by year, there seems to be a pronounced decrease in the intensity of the effect in recent times. The effect was strongest during the period of electoral turmoil in the 80s with the contest between the Congress and the Janata Party, and slowly decreased from then on. This is consistent with the temporal trend we observed in volatility, since a decline in one would correspond to the other as people become more fixed in their voting preferences.

``` {r change_line_year, echo=FALSE, eval=TRUE}
ggplot(means, aes(x = cycle)) +
  geom_line(aes(y = incumb_change, colour = "incumb_change")) + 
  geom_line(aes(y = state_incumb_change, colour = "state_incumb_change")) +
  geom_line(aes(y = nat_incumb_change, colour = "nat_incumb_change")) +
  labs(title = "Incumbents by Election") +
  xlab("Year") +
  ylab("Incumbent Voteshare Change") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r change_line_year_modern, echo=FALSE, eval=TRUE}
ggplot(means_modern, aes(x = cycle)) +
  geom_line(aes(y = incumb_change, colour = "incumb_change")) + 
  geom_line(aes(y = state_incumb_change, colour = "state_incumb_change")) +
  geom_line(aes(y = nat_incumb_change, colour = "nat_incumb_change")) +
  labs(title = "Incumbents by Election") +
  xlab("Year") +
  ylab("Incumbent Voteshare Change") +
  theme(axis.text.x = element_text(angle = 45))
```

## Independent Variable

To measure nationwide economic conditions over time, we use night-lights data as a proxy. This is a well-established though inherently limited practice. We can get night-lights data from SHRUG, which is divided on either side of 2013 into two different satellites' data. We therefore use the Li harmonized nightlights dataset.

We first clip the nightlights raster data to the extent of our two Indian assembly constituency shapefiles (before and after the 2008 delimitation).

``` {r shapefile, eval=FALSE}
ext_old <- extent(assembly_shp_old)
ext <- extent(assembly_shp)

nightlights_old <- assembly_shp_old %>%
  dplyr::select(state=State, ac_no=AC_NO, ac_name=AC_NAME)
nightlights <- assembly_shp %>%
  dplyr::select(state, ac_no=ac, ac_name)
```

We can then extract the mean nightlights (luminosity) value to each constituency, creating a constituency nightlights dataframe in wide format.

```{r upto2008, eval=FALSE}
# Before delimitation, old satellite
for (i in 1992:2007) {
  rasterfile <- raster(paste0("../shrug/li/clipped_", as.character(i), "_calDMSP.tif"))
  nightlights_old[paste0("ng_", as.character(i))] <- exact_extract(rasterfile, assembly_shp_old, 'mean', progress=FALSE)
}
```

``` {r 2008to2013, eval=FALSE}
# After delimitation, old satellite
for (i in 2008:2013) {
  rasterfile <- raster(paste0("../shrug/li/clipped_", as.character(i), "_calDMSP.tif"))
  nightlights[paste0("ng_", as.character(i))] <- exact_extract(rasterfile, assembly_shp, 'mean', progress=FALSE)
}
# st_write(nightlights_old, "./data/nightlights_old.shp", delete_dsn = T)
```

``` {r upto2021, eval=FALSE}
# After delimitation, new satellite
for (i in 2014:2021) {
  rasterfile <- raster(paste0("../shrug/li/clipped_", as.character(i), "_simVIIRS.tif"))
  nightlights[paste0("ng_", as.character(i))] <- exact_extract(rasterfile, assembly_shp, 'mean', progress=FALSE)
}
# st_write(nightlights, "./data/nightlights_new.shp", delete_dsn = T)
```

We now have a (long) constituency-over-years dataset of our dependent variable, electoral volatility, and a (wide) constituency-over-years dataset of our independent variable, nightlights, which we can clean and merge together.  
To do so, we first pivot the nightlights data to long format, then clean it to prepare for constructing our panel dataset.

``` {r pivot_nightlights, eval=FALSE}

nightlights <- nightlights%>%
  mutate(ng_2014 = 0.65*ng_2014)%>%
  mutate(ng_2015 = 0.55*ng_2015)%>%
  mutate(ng_2015 = 3.5*ng_2016)%>%
  mutate(ng_2021 = 0.75*ng_2021)

nightlights_old <- nightlights_old%>%
  pivot_longer(cols = starts_with("ng_"),
                          names_to = "delta_year",
                          values_to = "nightlights")%>%
  mutate(delta_year = gsub("ng_", "", delta_year))

nightlights <- nightlights%>%
  pivot_longer(cols = starts_with("ng_"),
                          names_to = "delta_year",
                          values_to = "nightlights")%>%
  mutate(delta_year = gsub("ng_", "", delta_year))
```

``` {r clean_nightlights, eval=FALSE}
nightlights <- rbind(nightlights_old, nightlights)

nightlights <- nightlights%>%
  mutate(delta_year = as.numeric(delta_year))%>%
  mutate(ac_no = as.numeric(ac_no))%>%
  mutate(state = gsub(" ", "_", state))%>%
  mutate(ac_name = gsub(" ", "_", ac_name))%>%
  mutate(state = str_to_upper(state))%>%
  mutate(ac_name = str_to_upper(ac_name))%>%
  mutate(state = gsub("ORISSA", "ODISHA", state))%>%
  mutate(state = gsub("TAMILNADU", "TAMIL_NADU", state))%>%
  mutate(state = gsub("UTTARANCHAL", "UTTARAKHAND", state))%>%
  mutate(state = if_else((delta_year < 2000) & (state == "UTTARAKHAND"), "UTTAR_PRADESH", state))%>%
  mutate(state = if_else((delta_year < 2000) & (state == "CHHATTISGARH"), "MADHYA_PRADESH", state))%>%
  mutate(state = if_else((delta_year < 2000) & (state == "JHARKHAND"), "BIHAR", state))%>%
  mutate(state = if_else((delta_year < 2014) & (state == "TELANGANA"), "ANDHRA_PRADESH", state))%>%
  arrange(state, ac_name, delta_year)

st_write(nightlights, "./data/nightlights.shp", delete_dsn = T)
```

``` {r read_nightlights, include=FALSE, eval=TRUE}
nightlights <- st_read("./data/nightlights.shp")
nightlights_old <- st_read("./data/nightlights_old.shp")
nightlights_new <- st_read("./data/nightlights_new.shp")

nightlights <- nightlights%>%
  rename(delta_year = delt_yr,
         nightlights = nghtlgh)
```

``` {r nightlights_table, echo=FALSE, eval=TRUE}
ng_table <- nightlights_new%>%
  dplyr::select(state, ac_name, ng_2008, ng_2021)

kable(head(ng_table, 10), caption="Nightlights Data")%>%
  kable_styling(font_size=12)
kable(nrow(ng_table))%>%
  kable_styling(font_size=12)
```

``` {r nightlights_graph, echo=FALSE, eval=FALSE}
ggplot(nightlights_old) +
  geom_sf(aes(fill=ng_1992), linetype=0) +
  ggtitle(label = "Nightlights in 1992") +
  scale_fill_viridis_c(option = "magma")

ggplot(nightlights_new) +
  geom_sf(aes(fill=ng_2009), linetype=0) +
  ggtitle(label = "Nightlights in 2009") +
  scale_fill_viridis_c(option = "magma")

ggplot(nightlights_new) +
  geom_sf(aes(fill=ng_2021), linetype=0) +
  ggtitle(label = "Nightlights in 2021") +
  scale_fill_viridis_c(option = "magma")
```

``` {r nightlights_time_graph, echo=FALSE, eval=FALSE}
means <- nightlights %>%
  group_by(delta_year)%>%
  summarise(mean_ng=mean(nightlights))

ggplot(means) +
  geom_line(aes(x = delta_year, y = mean_ng, colour="nightlights")) +
  geom_smooth(method = "lm", se = TRUE, color = "blue") + 
  labs(title = "Nightlights over time") +
  xlab("Year") +
  ylab("Mean Nightlights") +
  theme(axis.text.x = element_text(angle = 45)) +
  ylim(0, 100)
```

Now that we have both datasets in long format, we can merge the two together to create a single panel dataset on which we can run our fixed-effects model. We merge every year individually because of the large amount of constituency changes between years because of delimitation, creation of states, etc.

``` {r clean_volatility, eval=TRUE}
volatility <- volatility%>%
  mutate(election_year = as.numeric(Year))%>%
  mutate(Constituency_No = as.numeric(Constituency_No))%>%
  mutate(Assembly_No = as.numeric(Assembly_No))%>%
  mutate(State_Name = gsub(" ", "_", State_Name))%>%
  mutate(Constituency_Name = gsub(" ", "_", Constituency_Name))%>%
  mutate(State_Name = str_to_upper(State_Name))%>%
  mutate(Constituency_Name = str_to_upper(Constituency_Name))%>%
  mutate(State_Name = gsub("ORISSA", "ODISHA", State_Name))%>%
  arrange(State_Name, Constituency_Name)
```

``` {r merge_panel, eval=TRUE}
volatility_year <- volatility%>%
  filter(election_year == 1990)

panel_data <- stringdist_join(nightlights, volatility_year, method="lcs", mode="inner", distance_col = "distance", by = c("state" = "State_Name", "ac_name" = "Constituency_Name"))%>%
  group_by("state", "ac_name")%>%
  slice_min(order_by=distance, n=1)%>%
  ungroup()%>%
  filter(election_year >= delta_year)

for (i in 1991:2021) {
  volatility_year <- volatility%>%
    filter(election_year == i)
  
  data <- stringdist_join(nightlights, volatility_year, method="lcs", mode="inner", distance_col = "distance", by = c("state" = "State_Name", "ac_name" = "Constituency_Name"))%>%
  group_by("state", "ac_name")%>%
  slice_min(order_by=distance, n=1)%>%
  ungroup()%>%
  filter(election_year >= delta_year)
  
  panel_data <- rbind(panel_data, data)
}
```

``` {r filter_panel_data, eval=TRUE}
panel_data <- st_drop_geometry(panel_data)

panel <- panel_data%>%
  dplyr::select(state, ac_no, ac_name, delta_year, nightlights, Constituency_No, Constituency_Name, election_year, Assembly_No, Electors, Turnout, ENOP, volatility, incumb_change, state_incumb_change, nat_incumb_change)%>%
  filter(!is.na(nightlights))%>%
  distinct(state, ac_no, ac_name, election_year, delta_year, .keep_all = TRUE)%>%
  arrange(state, ac_name, election_year)
```

We then calculate our final independent variable metrics (relative and absolute changes in nightlights over differing time periods).

``` {r panel_iv, eval=TRUE}
panel <- panel%>%
  group_by(delta_year)%>%
  mutate(mean_nightlights = mean(nightlights))%>%
  ungroup()%>%

  group_by(state, ac_name)%>%
  mutate(absolute_change = nightlights - dplyr::lag(nightlights, n=1))%>%
  mutate(relative_change = ((nightlights - dplyr::lag(nightlights, n=1))/dplyr::lag(nightlights, n=1)) * 100)%>%
    
  mutate(absolute_change_3 = nightlights - dplyr::lag(nightlights, n=3))%>%
  mutate(relative_change_3 = ((nightlights - dplyr::lag(nightlights, n=3))/dplyr::lag(nightlights, n=3)) * 100)%>%
  
  group_by(state, ac_name)%>%
  mutate(absolute_change_t = nightlights - dplyr::lag(nightlights, n=5))%>%
  mutate(relative_change_t = ((nightlights - dplyr::lag(nightlights, n=5))/dplyr::lag(nightlights, n=5)) * 100)%>%
  ungroup()%>%
  
  mutate(past_three = rollmean(nightlights, k = 3, fill = NA, align = "right"))%>%
  mutate(absolute_change_p3 = past_three - dplyr::lag(past_three))%>%
  mutate(relative_change_p3 = ((past_three - dplyr::lag(past_three))/dplyr::lag(past_three)) * 100)%>%
  
  mutate(absolute_change_p3_3 = past_three - dplyr::lag(past_three, n=3))%>%
  mutate(relative_change_p3_3 = ((past_three - dplyr::lag(past_three, n=3))/dplyr::lag(past_three, n=3)) * 100)%>%
  
  mutate(absolute_change_p3_t = past_three - dplyr::lag(past_three, n=5))%>%
  mutate(relative_change_p3_t = ((past_three - dplyr::lag(past_three, n=5))/dplyr::lag(past_three, n=5)) * 100)%>%
  ungroup()
```

We can also calculate the other variables which could impact electoral volatility (changes in ENOP, Turnout, etc), which we'll use as controls.

``` {r panel_confounders, eval=TRUE}
panel <- panel%>%
  filter(delta_year == (election_year-1))%>%
  
  group_by(state, ac_name)%>%
  mutate(delta_ENOP = ENOP - dplyr::lag(ENOP, n=1))%>%
  mutate(delta_Turnout = Turnout - dplyr::lag(Turnout, n=1))%>%
  mutate(years_since_election = election_year - dplyr::lag(election_year, n=1))%>%
  ungroup()%>%
  
  filter(!is.na(relative_change))%>%
  filter(is.finite(relative_change))%>%
  filter(!is.na(relative_change_3))%>%
  filter(is.finite(relative_change_3))%>%
  filter(!is.na(relative_change_p3))%>%
  filter(is.finite(relative_change_p3))%>%
  filter(!is.na(relative_change_t))%>%
  filter(is.finite(relative_change_t))%>%
  filter(!is.na(volatility))%>%
  filter(is.finite(volatility))
```

We eliminate outliers caused by low-value nightlights data and data errors, which gives us our final panel dataset.

``` {r outliers, eval=TRUE}
write.csv(panel, "./data/panel_dataset_with_outliers.csv", row.names=FALSE)
panel_with_outliers <- panel

Q1_1 <- quantile(panel$relative_change, .25)
Q3_1 <- quantile(panel$relative_change, .75)
IQR_1 <- IQR(panel$relative_change)

Q1_2 <- quantile(panel$relative_change_t, .25)
Q3_2 <- quantile(panel$relative_change_t, .75)
IQR_2 <- IQR(panel$relative_change_t)

panel <- panel%>%
  filter((relative_change > (Q1_1 - 1.25*IQR_1)) & (relative_change < (Q3_1 + 1.25*IQR_1)))%>%
  filter((relative_change_t > (Q1_2 - 1.25*IQR_2)) & (relative_change_t < (Q3_2 + 1.25*IQR_2)))%>%
  mutate(state = gsub("_", " ", state))%>%
  mutate(state = gsub("&", " ", state))

write.csv(panel, "./data/panel_dataset.csv", row.names=FALSE)
```

``` {r panel, include=FALSE, eval=TRUE}
panel <- read.csv("./data/panel_dataset.csv")
panel <- panel%>%
  mutate(state = gsub("_", " ", state))%>%
  mutate(state = gsub("&", " ", state))%>%
  mutate(
    cycle = case_when(
      election_year >= 2021 & election_year <= 2025 ~ 2021,
      election_year >= 2016 & election_year <= 2020 ~ 2016,
      election_year >= 2011 & election_year <= 2015 ~ 2011,
      election_year >= 2006 & election_year <= 2010 ~ 2006,
      election_year >= 2001 & election_year <= 2005 ~ 2001,
      election_year >= 1996 & election_year <= 2000 ~ 1996,
      election_year >= 1991 & election_year <= 1995 ~ 1991,
    ))
```

This dataset represents more than thirteen thousand constituency-elections across India from 1996 to 2019. Let's have a look at the data:

``` {r panel_table, echo=FALSE, eval=TRUE}
panel_table <- panel%>%
  dplyr::select(state, ac_name, election_year, volatility, delta_year, nightlights)

kable(head(panel_table, 10))%>%
  kable_styling(font_size=10)
kable(nrow(panel_table))%>%
  kable_styling(font_size=10)
```

``` {r panel_summary, echo=FALSE, eval=TRUE}
sumtable(panel)%>%
  kable_styling(font_size=10)
```

``` {r panel_volatility_dist, echo=FALSE, eval=TRUE}
ggplot(panel, aes(x=volatility)) +
  geom_histogram(color="skyblue", fill="white") +
  labs(title = "Distribution of volatility values") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r panel_relativechange_dist, echo=FALSE, eval=TRUE}
ggplot(panel, aes(x=relative_change)) +
  geom_histogram(color="skyblue", fill="white") +
  labs(title = "Distribution of relative change values") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r panel_graph, echo=FALSE, eval=TRUE}
means <- panel%>%
  group_by(delta_year)%>%
  summarise(mean_nightlights=mean(nightlights), relative_change=mean(relative_change), relative_change_t=mean(relative_change_t), across())%>%
  ungroup()%>%
  group_by(cycle)%>%
  summarise(mean_volatility=mean(volatility), across())%>%
  ungroup()

ggplot(means) +
  geom_line(aes(x=delta_year, y=relative_change, colour = "relative_change")) +
  geom_line(aes(x=delta_year, y=relative_change_t, colour = "relative_change_t")) +
  geom_line(aes(x=cycle, y=mean_volatility, colour = "mean_volatility")) +
  labs(title = "Nightlights and Volatility Over Years") +
  xlab("Year") +
  ylab("Nightlights and Volatility") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r panel_state_graph, echo=FALSE, eval=TRUE}
means <- panel%>%
  group_by(delta_year, state)%>%
  summarise(mean_nightlights=mean(nightlights), relative_change=mean(relative_change), relative_change_t=mean(relative_change_t), across())%>%
  ungroup()%>%
  group_by(cycle, state)%>%
  summarise(mean_volatility=mean(volatility), across())%>%
  ungroup()

ggplot(means) +
  geom_line(aes(x=delta_year, y=relative_change, colour = "relative_change")) +
  geom_line(aes(x=delta_year, y=relative_change_t, colour = "relative_change_t")) +
  geom_line(aes(x=cycle, y=mean_volatility, colour = "mean_volatility")) +
  facet_wrap(~state) +
  labs(title = "Nightlights and Volatility Over Years") +
  xlab("Year") +
  ylab("Nightlights and Volatility") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r panel_correlation, echo=FALSE, eval=TRUE}
means <- panel%>%
  group_by(state)%>%
  summarise(mean_nightlights=mean(nightlights), relative_change=mean(relative_change), relative_change_t=mean(relative_change_t), mean_volatility=mean(volatility), across())%>%
  ungroup()

ggplot(means, aes(x=relative_change, y=mean_volatility, colour=state)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE, color = "blue") + 
  labs(title = "Nightlights and Volatility by State") +
  xlab("Mean % Change in Nightlights") +
  ylab("Mean Volatility") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r panel_correlation_facet, echo=FALSE, eval=TRUE}
means <- panel%>%
  group_by(state, cycle)%>%
  summarise(mean_nightlights=mean(nightlights), relative_change=mean(relative_change), relative_change_t=mean(relative_change_t), mean_volatility=mean(volatility), across())%>%
  ungroup()

ggplot(means, aes(x=relative_change, y=mean_volatility, colour=state)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE, color = "blue") + 
  labs(title = "Nightlights and Volatility Over Years") +
  facet_wrap(~cycle) +
  xlab("Mean % Change in Nightlights") +
  ylab("Mean Volatility") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r panel_correlation_const, echo=FALSE, eval=TRUE}
means <- panel%>%
  group_by(ac_name)%>%
  summarise(mean_nightlights=mean(nightlights), relative_change=mean(relative_change), relative_change_t=mean(relative_change_t), mean_volatility=mean(volatility), across())%>%
  ungroup()

ggplot(means, aes(x=relative_change, y=mean_volatility)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE, color = "blue") + 
  labs(title = "Nightlights and Volatility by Const") +
  xlab("Mean % Change in Nightlights") +
  ylab("Mean Volatility") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r panel_correlation_facet_const, echo=FALSE, eval=TRUE}
means <- panel%>%
  group_by(ac_name, cycle)%>%
  summarise(mean_nightlights=mean(nightlights), relative_change=mean(relative_change), relative_change_t=mean(relative_change_t), mean_volatility=mean(volatility), across())%>%
  ungroup()

ggplot(means, aes(x=relative_change, y=mean_volatility)) +
  geom_point() +
  geom_smooth(method = "lm", se = TRUE, color = "blue") + 
  labs(title = "Nightlights and Volatility Over Years") +
  facet_wrap(~cycle) +
  xlab("Mean % Change in Nightlights") +
  ylab("Mean Volatility") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r nightlights_gdp, echo=FALSE, eval=TRUE}
sndp <- read.csv("./data/cso_sgdp.csv")
sndp <- sndp %>%
  pivot_longer(cols = starts_with("X"),
                          names_to = "delta_year",
                          values_to = "pc_sndp")%>%
  mutate(delta_year = gsub("X", "", delta_year))%>%
  mutate(delta_year = gsub("\\..*", "", delta_year))%>%
  mutate(delta_year = as.numeric(delta_year))%>%
  filter(delta_year >= 1990)%>%
  mutate(state = str_to_upper(State.U.T.))%>%
  mutate(state = gsub(" ", "_", state))%>%
  na.omit()

sndp_means <- sndp%>%
  group_by(delta_year)%>%
  summarise(pc_sndp_mean=mean(pc_sndp))%>%
  ungroup()

means <- panel%>%
  group_by(delta_year)%>%
  summarise(mean_nightlights=mean(nightlights)*500, relative_change=mean(relative_change), relative_change_t=mean(relative_change_t), mean_volatility=mean(volatility), across())%>%
  ungroup()

ggplot() +
  geom_line(data=means, aes(x=delta_year, y=mean_nightlights, colour = "mean_nightlights")) +
  geom_line(data=sndp_means, aes(x=delta_year, y=pc_sndp_mean, colour = "pc_sndp")) +
  labs(title = "Nightlights and SGDP Over Years") +
  xlab("Year") +
  ylab("Nightlights and SGDP") +
  theme(axis.text.x = element_text(angle = 45))
```

We now implement our empirical strategy. Our independent variable is represented by five measures:  

* Absolute change in nightlights in the preceding year
* Relative change in nightlights in the preceding year
* Relative change in nightlights in the preceding 3 years
* Relative change in nightlights since the last election
* Relative change in the average nightlights of the last three years versus the previous three
* Relative change in the average nightlights of the last three years versus the previous three

Our dependent variable is represented by four measures: 

* Change in Incumbent Party's Voteshare
* Change in State-ruling Party's Voteshare
* Change in Central-ruling Party's Voteshare
* Electoral Volatility

We'll use a fixed-effects model controlling for state, year, and non-economic determinants to look at the effect.

``` {r model_relative_change_basic, eval=TRUE}
model_rc <- plm(volatility ~ relative_change_t + election_year + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc2 <- plm(incumb_change ~ relative_change_t + election_year + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc3 <- plm(state_incumb_change ~ relative_change_t + election_year + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc4 <- plm(nat_incumb_change ~ relative_change_t + election_year + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

stargazer(model_rc, model_rc2, model_rc3, model_rc4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```

``` {r model_absolute_change, eval=TRUE}
model_ac <- plm(volatility ~ absolute_change + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_ac2 <- plm(incumb_change ~ absolute_change + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_ac3 <- plm(state_incumb_change ~ absolute_change + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_ac4 <- plm(nat_incumb_change ~ absolute_change + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

stargazer(model_ac, model_ac2, model_ac3, model_ac4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```

``` {r model_relative_change, eval=TRUE}
model_rc <- plm(volatility ~ relative_change + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("ac_name", "ac_name", "election_year"), model="within")

model_rc2 <- plm(incumb_change ~ relative_change + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("ac_name", "ac_name", "election_year"), model="within")

model_rc3 <- plm(state_incumb_change ~ relative_change + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("ac_name", "ac_name", "election_year"), model="within")

model_rc4 <- plm(nat_incumb_change ~ relative_change + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("ac_name", "ac_name", "election_year"), model="within")

stargazer(model_rc, model_rc2, model_rc3, model_rc4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```

``` {r model_relative_change_3, eval=TRUE}
model_rc <- plm(volatility ~ relative_change_3 + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc2 <- plm(incumb_change ~ relative_change_3 + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc3 <- plm(state_incumb_change ~ relative_change_3 + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc4 <- plm(nat_incumb_change ~ relative_change_3 + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

stargazer(model_rc, model_rc2, model_rc3, model_rc4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```

``` {r model_relative_change_t, eval=TRUE}
model_rc <- plm(volatility ~ relative_change_p3_t + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc2 <- plm(incumb_change ~ relative_change_p3_t + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc3 <- plm(state_incumb_change ~ relative_change_p3_t + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc4 <- plm(nat_incumb_change ~ relative_change_p3_t + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

stargazer(model_rc, model_rc2, model_rc3, model_rc4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```

``` {r model_relative_change_p3, eval=TRUE}
model_rc <- plm(volatility ~ relative_change_p3 + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc2 <- plm(incumb_change ~ relative_change_p3 + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc3 <- plm(state_incumb_change ~ relative_change_p3 + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

model_rc4 <- plm(nat_incumb_change ~ relative_change_p3 + election_year + delta_ENOP + delta_Turnout + years_since_election + Electors + factor(state), data = panel, index=c("state", "ac_name", "election_year"), model="within")

stargazer(model_rc, model_rc2, model_rc3, model_rc4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```

``` {r model_graph, echo=FALSE, eval=TRUE}
ggplot(panel, aes(x = relative_change, y = volatility)) +
  geom_point() +
  geom_smooth(method = "lm", color = "blue") + 
  labs(title = "Relative Change vs Volatility")

ggplot(panel, aes(x = relative_change, y = incumb_change)) +
  geom_point() +
  geom_smooth(method = "lm", color = "blue") + 
  labs(title = "Relative Change vs Incumbent Change")

ggplot(panel, aes(x = relative_change, y = state_incumb_change)) +
  geom_point() +
  geom_smooth(method = "lm", color = "blue") + 
  labs(title = "Relative Change vs State Incumbent Change")

ggplot(panel, aes(x = relative_change, y = nat_incumb_change)) +
  geom_point() +
  geom_smooth(method = "lm", color = "blue") + 
  labs(title = "Relative Change vs National Incumbent Change")

ggplot(panel, aes(x = relative_change_t, y = volatility)) +
  geom_point() +
  geom_smooth(method = "lm", color = "blue") + 
  labs(title = "Relative Change over tenure vs Volatility")

ggplot(panel, aes(x = relative_change_t, y = incumb_change)) +
  geom_point() +
  geom_smooth(method = "lm", color = "blue") + 
  labs(title = "Relative Change over tenure vs Incumbent Change")

ggplot(panel, aes(x = relative_change_t, y = state_incumb_change)) +
  geom_point() +
  geom_smooth(method = "lm", color = "blue") + 
  labs(title = "Relative Change over tenure vs State Incumbent Change")

ggplot(panel, aes(x = relative_change_t, y = state_incumb_change)) +
  geom_point() +
  geom_smooth(method = "lm", color = "blue") + 
  labs(title = "Relative Change over tenure vs National Incumbent Change")
```

Since we couldn't draw any comparisons from all of India, let's restrict our scope. Dash & Ferris uses the following 14 states from 1957 to 2011. Unfortunately, we'll have to restrict our analysis to the period after 1991 since there is no nightlights data before that. However, we can replicate the analysis for these states from 1991 to 2011.

``` {r filter_panel, include=FALSE, eval=TRUE}
filterpanel <- panel%>%
  filter(election_year <= 2011)%>%
  filter((state == "ANDHRA PRADESH") | (state == "BIHAR") | (state == "GUJARAT") | (state == "HARYANA") | (state == "KARNATAKA") | (state == "KERALA") | (state == "MADHYA PRADESH") | (state == "MAHARASHTRA") | (state == "ODISHA") | (state == "PUNJAB") | (state == "RAJASTHAN") | (state == "TAMIL NADU") | (state == "UTTAR PRADESH") | (state == "WEST BENGAL"))
```

``` {r filter_panel_table, echo=FALSE, eval=TRUE}
panel_table <- filterpanel%>%
  dplyr::select(state, ac_name, election_year, volatility, delta_year, nightlights)

kable(head(panel_table, 10))%>%
  kable_styling(font_size=10)
kable(nrow(panel_table))%>%
  kable_styling(font_size=10)
```

``` {r filter_panel_volatility_dist, echo=FALSE, eval=TRUE}
ggplot(filterpanel, aes(x=volatility)) +
  geom_histogram(color="skyblue", fill="white") +
  labs(title = "Distribution of volatility values") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r filter_panel_relativechange_dist, echo=FALSE, eval=TRUE}
ggplot(filterpanel, aes(x=relative_change)) +
  geom_histogram(color="skyblue", fill="white") +
  labs(title = "Distribution of relative change values") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r filter_panel_graph, echo=FALSE, eval=TRUE}
means <- filterpanel%>%
  group_by(delta_year)%>%
  summarise(mean_nightlights=mean(nightlights), relative_change=mean(relative_change), relative_change_t=mean(relative_change_t), across())%>%
  ungroup()%>%
  group_by(cycle)%>%
  summarise(mean_volatility=mean(volatility), across())%>%
  ungroup()

ggplot(means) +
  geom_line(aes(x=delta_year, y=relative_change, colour = "relative_change")) +
  geom_line(aes(x=delta_year, y=relative_change_t, colour = "relative_change_t")) +
  geom_line(aes(x=cycle, y=mean_volatility, colour = "mean_volatility")) +
  labs(title = "Nightlights and Volatility Over Years") +
  xlab("Year") +
  ylab("Nightlights and Volatility") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r filter_panel_state_graph, echo=FALSE, eval=TRUE}
means <- filterpanel%>%
  group_by(delta_year, state)%>%
  summarise(mean_nightlights=mean(nightlights), relative_change=mean(relative_change), relative_change_t=mean(relative_change_t), across())%>%
  ungroup()%>%
  group_by(cycle, state)%>%
  summarise(mean_volatility=mean(volatility), across())%>%
  ungroup()

ggplot(means) +
  geom_line(aes(x=delta_year, y=relative_change, colour = "relative_change")) +
  geom_line(aes(x=delta_year, y=relative_change_t, colour = "relative_change_t")) +
  geom_line(aes(x=cycle, y=mean_volatility, colour = "mean_volatility")) +
  facet_wrap(~state) +
  labs(title = "Nightlights and Volatility Over Years") +
  xlab("Year") +
  ylab("Nightlights and Volatility") +
  theme(axis.text.x = element_text(angle = 45))
```

``` {r filter_model_relative_change, eval=TRUE}
model_rc <- plm(volatility ~ relative_change_p3 + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc2 <- plm(incumb_change ~ relative_change_p3 + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc3 <- plm(state_incumb_change ~ relative_change_p3 + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc4 <- plm(nat_incumb_change ~ relative_change_p3 + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

stargazer(model_rc, model_rc2, model_rc3, model_rc4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```

``` {r filter_model_relative_change_t, eval=TRUE}
model_rc <- plm(volatility ~ relative_change_t + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc2 <- plm(incumb_change ~ relative_change_t + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc3 <- plm(state_incumb_change ~ relative_change_t + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc4 <- plm(nat_incumb_change ~ relative_change_t + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

stargazer(model_rc, model_rc2, model_rc3, model_rc4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```

Even this fails! Let's look at only one electoral cycle. The 2009 general election spotlighted the economy as a key electoral issue. That electoral cycle should indicate a strong correlation.

``` {r filter2_panel, include=FALSE, eval=TRUE}
filterpanel2 <- panel%>%
  filter(cycle == 2006)
```

``` {r filter2_panel_table, echo=FALSE, eval=TRUE}
panel_table <- filterpanel2%>%
  dplyr::select(state, ac_name, election_year, volatility, delta_year, nightlights)

kable(head(panel_table, 10))%>%
  kable_styling(font_size=10)
kable(nrow(panel_table))%>%
  kable_styling(font_size=10)
```

``` {r filter2_model_relative_change, eval=TRUE}
model_rc <- plm(volatility ~ relative_change_p3 + election_year + factor(state), data = filterpanel2, index=c("state", "ac_name", "election_year"), model="within")

model_rc2 <- plm(incumb_change ~ relative_change_p3 + election_year + factor(state), data = filterpanel2, index=c("state", "ac_name", "election_year"), model="within")

model_rc3 <- plm(state_incumb_change ~ relative_change_p3 + election_year + factor(state), data = filterpanel2, index=c("state", "ac_name", "election_year"), model="within")

model_rc4 <- plm(nat_incumb_change ~ relative_change_p3 + election_year + factor(state), data = filterpanel2, index=c("state", "ac_name", "election_year"), model="within")

stargazer(model_rc, model_rc2, model_rc3, model_rc4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```

``` {r filter2_model_relative_change_t, eval=TRUE}
model_rc <- plm(volatility ~ relative_change_t + election_year + factor(state), data = filterpanel2, index=c("state", "ac_name", "election_year"), model="within")

model_rc2 <- plm(incumb_change ~ relative_change_t + election_year + factor(state), data = filterpanel2, index=c("state", "ac_name", "election_year"), model="within")

model_rc3 <- plm(state_incumb_change ~ relative_change_t + election_year + factor(state), data = filterpanel2, index=c("state", "ac_name", "election_year"), model="within")

model_rc4 <- plm(nat_incumb_change ~ relative_change_t + election_year + factor(state), data = filterpanel2, index=c("state", "ac_name", "election_year"), model="within")

stargazer(model_rc, model_rc2, model_rc3, model_rc4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```

Only negative growth constituencies

``` {r filter_model_relative_change2, eval=TRUE}
filterpanel <- filterpanel%>%
  filter(relative_change_p3 < 0)

model_rc <- plm(volatility ~ relative_change_p3 + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc2 <- plm(incumb_change ~ relative_change_p3 + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc3 <- plm(state_incumb_change ~ relative_change_p3 + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc4 <- plm(nat_incumb_change ~ relative_change_p3 + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

stargazer(model_rc, model_rc2, model_rc3, model_rc4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```

``` {r filter_model_relative_change_t2, eval=TRUE}
model_rc <- plm(volatility ~ relative_change_t + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc2 <- plm(incumb_change ~ relative_change_t + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc3 <- plm(state_incumb_change ~ relative_change_t + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

model_rc4 <- plm(nat_incumb_change ~ relative_change_t + election_year + factor(state), data = filterpanel, index=c("state", "ac_name", "election_year"), model="within")

stargazer(model_rc, model_rc2, model_rc3, model_rc4, type="text", report=("vcsp*"), omit=c("state", "election_year"))
```
